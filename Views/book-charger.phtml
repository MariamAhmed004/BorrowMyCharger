<?php require_once('template/header.phtml'); ?>

  <div class="container mt-5">
    <!-- Top Section: Title, Description, Location info, and Image -->
    <h1>Book Charging Point</h1>
    <div class="row">
      <!-- Left Column: Location info -->
      <div class="col-md-6">
        <h4>Location</h4>
        <div class="form-group">
          <label><strong>Home:</strong> <?= htmlspecialchars($view->chargerDetails['houseNumber']) ?>, <?= htmlspecialchars($view->chargerDetails['streetName']) ?></label>
        </div>
        <div class="form-group">
          <label><strong>Road:</strong> <?= htmlspecialchars($view->chargerDetails['road']) ?></label>
        </div>
        <div class="form-group">
          <label><strong>City:</strong> <?= htmlspecialchars($view->chargerDetails['cityName']) ?></label>
        </div>
        <div class="form-group">
          <label><strong>Price:</strong></label><br />
          <span><?= htmlspecialchars($view->chargerDetails['pricePerKwh']) ?> BHD / kWh</span>
        </div>
      </div>

      <!-- Right Column: Image -->
      <div class="col-md-6 text-center">
        <img src="<?= htmlspecialchars($view->chargerDetails['chargePointPictureUrl']) ?>" alt="Charge Point Image" class="charge-point-image" />
      </div>
    </div>

    <!-- Availability Section (Centered & Full-Width) -->
    <div class="availability-container">
      <h4 class="text-left">Availability</h4>

      <?php if ($view->hasAvailability): ?>
        <div class="row no-gutters">
          <div class="col-md-12">
            <div class="form-group">
              <label for="availability-date">Select Availability Date:</label>
              <select class="form-control" id="availability-date" onchange="showTimeOptions()">
                <option value="">Select Date</option>
                <?php foreach ($view->availableDays as $day): 
                  // Only include days that have time slots
                  if (isset($view->availableTimes[$day]) && !empty($view->availableTimes[$day])): ?>
                    <option value="<?= htmlspecialchars(trim($day)) ?>"><?= ucfirst(htmlspecialchars(trim($day))) ?></option>
                  <?php endif; ?>
                <?php endforeach; ?>
              </select>
            </div>
          </div>
        </div>

        <!-- Time Options as buttons -->
        <div class="time-options" id="time-options">
          <!-- Time options will be populated dynamically -->
        </div>

        <!-- Submit Button -->
        <div class="submit-button">
          <button class="btn btn-primary" id="book-button" disabled>Book Now</button>
        </div>
        
        <!-- Hidden input to store selected time -->
        <input type="hidden" id="selected-time" value="" />
      <?php else: ?>
        <div class="no-availability-message">
          <p>This charging point currently has no available time slots.</p>
        </div>
      <?php endif; ?>
    </div>
  </div>

  <script>
    // Store the available times as a JavaScript object
    const availableTimes = <?= json_encode($view->availableTimes) ?>;
    
    // Function to show time options based on the selected day
    function showTimeOptions() {
      const selectedDay = document.getElementById('availability-date').value;
      const timeOptionsContainer = document.getElementById('time-options');
      const bookButton = document.getElementById('book-button');
      const selectedTimeInput = document.getElementById('selected-time');
      
      // Reset the button to disabled and clear the selected time
      bookButton.disabled = true;
      selectedTimeInput.value = '';
      
      // Clear previous time options
      timeOptionsContainer.innerHTML = '';
      
      // Check if the selected day has any available times
      if (selectedDay && availableTimes[selectedDay]) {
        // Populate available times for the selected day as buttons
        availableTimes[selectedDay].forEach(time => {
          const timeButton = document.createElement('div');
          timeButton.className = 'time-option';
          
          // Format the time to be more readable (e.g., "14:00:00" to "2:00 PM")
          const timeObj = new Date(`1970-01-01T${time}`);
          const formattedTime = timeObj.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
          
          timeButton.textContent = formattedTime;
          timeButton.dataset.time = time;
          
          // Add click event to select time
          timeButton.addEventListener('click', function() {
            // Remove selected class from all time options
            document.querySelectorAll('.time-option').forEach(el => {
              el.classList.remove('selected');
            });
            
            // Add selected class to the clicked option
            this.classList.add('selected');
            
            // Store the selected time
            selectedTimeInput.value = this.dataset.time;
            
            // Enable the book button
            bookButton.disabled = false;
          });
          
          timeOptionsContainer.appendChild(timeButton);
        });
      }
    }
    
    // Add event listener for the book button
    document.getElementById('book-button').addEventListener('click', function() {
      const selectedDay = document.getElementById('availability-date').value;
      const selectedTime = document.getElementById('selected-time').value;
      
      if (selectedDay && selectedTime) {
        // Here you would typically submit the form or make an AJAX request
        alert(`Booking requested for ${selectedDay} at ${selectedTime}`);
        
      
      } else {
        alert('Please select both day and time.');
      }
    });
  </script>
<?php require_once('template/footer.phtml'); ?>